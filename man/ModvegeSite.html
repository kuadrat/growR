<!DOCTYPE html><html><head><title>R: ModvegeSite</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body><div class="container">

<table style="width: 100%;"><tr><td>ModvegeSite</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>ModvegeSite</h2>

<h3>Description</h3>

<p>Implements the modvege grass growth model based off of Jouven et al. (2006).
</p>
<p>This class contains model and site parameters and state variables as
attributes and has methods for running modvege with weather and management
input.
</p>
<p>Use the <code>run()</code> method to carry out a simulation for a given year. The
results are stored in the state variables in this instance and can be written
to file using <code>write_output()</code>.
</p>


<h3>Model variables</h3>

<p>See Jouven et al. (2006) for a thorough description of all model variables.
</p>


<h4>State Variables</h4>


<dl>
<dt>BM</dt><dd><p>Standing biomass in kg DM per ha.</p>
</dd>
<dt>BMG</dt><dd><p>Standing green biomass (kg DM / ha).</p>
</dd>
<dt>cBM</dt><dd><p>Cumulativeley grown biomass (kg DM / ha).</p>
</dd>
<dt>dBM</dt><dd><p>Daily grown biomass (kg DM / ha).</p>
</dd>
<dt>hvBM</dt><dd><p>Cumulative harvested biomass (kg DM / ha).</p>
</dd>
<dt>OMD</dt><dd><p>Organic matter digestibility (kg / kg).</p>
</dd>
<dt>OMDG</dt><dd><p>OMD of green matter (kg / kg).</p>
</dd>
<dt>ST</dt><dd><p>Temperature sum in degree Celsius days.</p>
</dd>
<dt>REP</dt><dd><p>Reproductive function. Gives the fraction of growth that is
assigned to reproductive growth. The remainder goes into vegetative growth.
Dimensionless.</p>
</dd>
<dt>PGRO</dt><dd><p>Potential growth in kg DM / ha.</p>
</dd>
<dt>GRO</dt><dd><p>Effective growth in kg DM / ha.</p>
</dd>
<dt>LAI</dt><dd><p>Leaf area index, accounting for the proportion of light
intercepted by the sward. Dimensionless.</p>
</dd>
<dt>LAIGV</dt><dd><p>LAI of green vegetative biomass. Dimensionless.</p>
</dd>
<dt>AET</dt><dd><p>Actual evapotranspiration in mm.</p>
</dd>
<dt>WR</dt><dd><p>Water reserves in mm.</p>
</dd>
<dt>ENV</dt><dd><p>Function representing environmental effects on growth. Acts as a
multiplicative factor. Dimensionless.</p>
</dd>
<dt>ENVfPAR</dt><dd><p>Part of ENV due to strength of incident radiation. Dimensionless.</p>
</dd>
<dt>ENVfT</dt><dd><p>Part of ENV due to temperature. Dimensionless.</p>
</dd>
<dt>ENVfW</dt><dd><p>Part of ENV due to water limitation. Dimensionless.</p>
</dd>
</dl>




<h4>Initial conditions</h4>


<dl>
<dt>AgeGV</dt><dd><p>Age of green vegetative matter in degree Celsius days.</p>
</dd>
<dt>AgeGR</dt><dd><p>Age of green reproductive matter in degree Celsius days.</p>
</dd>
<dt>AgeDV</dt><dd><p>Age of dead vegetative matter in degree Celsius days.</p>
</dd>
<dt>AgeDR</dt><dd><p>Age of dead reproductive matter in degree Celsius days.</p>
</dd>
<dt>BMGV</dt><dd><p>biomass of GV (kg DM per ha).</p>
</dd>
<dt>BMGR</dt><dd><p>biomass of GR (kg DM per ha).</p>
</dd>
<dt>BMDV</dt><dd><p>biomass of DV (kg DM per ha).</p>
</dd>
<dt>BMDR</dt><dd><p>biomass of DR (kg DM per ha).</p>
</dd>
<dt>BMDR</dt><dd><p>biomass of DR (kg DM per ha).</p>
</dd>
<dt>SENGV</dt><dd><p>senescence of GV (kg DM per ha).</p>
</dd>
<dt>SENGV</dt><dd><p>senescence of GR (kg DM per ha).</p>
</dd>
<dt>ABSGV</dt><dd><p>abscission of DV (kg DM per ha).</p>
</dd>
<dt>ABSGV</dt><dd><p>abscission of DR (kg DM per ha).</p>
</dd>
<dt>ST</dt><dd><p>thermal time (degree days).</p>
</dd>
<dt>cBM</dt><dd><p>cumulative total biomass (kg per ha).</p>
</dd>
</dl>




<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>time_step</code></dt><dd><p>Used time step in the model in days (untested).</p>
</dd>
<dt><code>state_variable_namse</code></dt><dd><p>Vector containing the names of the model's
state variables.</p>
</dd>
<dt><code>n_state_variables</code></dt><dd><p>Number of state variables.</p>
</dd>
<dt><code>version</code></dt><dd><p>Version number of the rmodvege package. Is written into
output files.</p>
</dd>
<dt><code>site_name</code></dt><dd><p>Name of the site to be simulated.</p>
</dd>
<dt><code>run_name</code></dt><dd><p>Name of the simulation run. Used to distinguish between
different runs at the same site.</p>
</dd>
<dt><code>year</code></dt><dd><p>Year to be simulated.</p>
</dd>
<dt><code>j_start_of_growing_season</code></dt><dd><p>Index (DOY) of the day the growing season
was determined to begin.</p>
</dd>
<dt><code>cut_height</code></dt><dd><p>Height of remaining grass after cut in m.</p>
</dd>
<dt><code>parameters</code></dt><dd><p>A ModvegeParameters object.</p>
</dd>
<dt><code>determine_cut</code></dt><dd><p>Function used to decide whether a cut occurs on a
given DOY. Is overloaded depending on whether management data is
provided or not.</p>
</dd>
<dt><code>cut_DOYs</code></dt><dd><p>List of DOYs on which a cut occurred.</p>
</dd>
<dt><code>cut_during_growth_preriod</code></dt><dd><p>Boolean to indicate whether a cut
occurred during the growth period, in which case reproductive growth is
stopped.</p>
</dd>
<dt><code>last_DOY_for_initial_cut</code></dt><dd><p><strong>autocut</strong> Start cutting after this DOY,
even if yield target is not reached.</p>
</dd>
<dt><code>max_cut_period</code></dt><dd><p><strong>autocut</strong> Maximum period to wait between
subsequent cuts.</p>
</dd>
<dt><code>dry_precipitation_limit</code></dt><dd><p><strong>autocut</strong> Maximum amount of allowed
precipitation (mm) to consider a day.</p>
</dd>
<dt><code>dry_days_before_cut</code></dt><dd><p><strong>autocut</strong> Number of days that shold be dry
before a cut is made.</p>
</dd>
<dt><code>dry_days_after_cut</code></dt><dd><p><strong>autocut</strong> Number of days that shold be dry
after a cut is made.</p>
</dd>
<dt><code>max_cut_delay</code></dt><dd><p><strong>autocut</strong> Number of days a farmer is willing to
wait for dry conditions before a cut is made anyways.</p>
</dd>
<dt><code>cut_delays</code></dt><dd><p><strong>autocut</strong> Vector to keep track of cut delay times.
wait for dry conditions before a cut is made anyways.</p>
</dd>
<dt><code>dry_window</code></dt><dd><p><strong>autocut</strong> Logical that indicates if DOY at index is
considered dry enough to cut.</p>
</dd>
<dt><code>target_biomass</code></dt><dd><p><strong>autocut</strong> Biomass amount that should to be reached
by given DOY for a cut to be made.</p>
</dd>
<dt><code>end_of_cutting_season</code></dt><dd><p><strong>autocut</strong> Determined DOY after which no
more cuts are made.</p>
</dd>
<dt><code>BM_after_cut</code></dt><dd><p><strong>autocut</strong> Amount of biomass that remains after a cut
(determined through cut_height and biomass densities BDGV, BDDV, BDGR,
BDDR).</p>
</dd>
<dt><code>weather</code></dt><dd><p>A WeatherData object.</p>
</dd>
<dt><code>management</code></dt><dd><p>A ManagementData object. If its <code>is_empty</code> field is <code>TRUE</code>,
the autocut routine will be employed.</p>
</dd>
</dl>

</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>state_variable_namse</code></dt><dd><p>Vector containing the names of the model's
state variables.</p>
</dd>
</dl>

</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-ModvegeSite-new"><code>ModvegeSite$new()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-initialize_state_variables"><code>ModvegeSite$initialize_state_variables()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-get_weather"><code>ModvegeSite$get_weather()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-get_management"><code>ModvegeSite$get_management()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-get_start_of_growing_season"><code>ModvegeSite$get_start_of_growing_season()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-carry_over_from_last_day"><code>ModvegeSite$carry_over_from_last_day()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-calculate_growth"><code>ModvegeSite$calculate_growth()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-calculate_ageing"><code>ModvegeSite$calculate_ageing()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-update_biomass"><code>ModvegeSite$update_biomass()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-calculate_digestibility"><code>ModvegeSite$calculate_digestibility()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-apply_cuts"><code>ModvegeSite$apply_cuts()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-determine_cut_from_input"><code>ModvegeSite$determine_cut_from_input()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-determine_cut_automatically"><code>ModvegeSite$determine_cut_automatically()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-check_dry_days"><code>ModvegeSite$check_dry_days()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-get_target_biomass"><code>ModvegeSite$get_target_biomass()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-run"><code>ModvegeSite$run()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-make_header"><code>ModvegeSite$make_header()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-write_output"><code>ModvegeSite$write_output()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-set_parameters"><code>ModvegeSite$set_parameters()</code></a>
</p>
</li>
<li> <p><a href="#method-ModvegeSite-clone"><code>ModvegeSite$clone()</code></a>
</p>
</li></ul>


<hr>
<a id="method-ModvegeSite-new"></a>



<h4>Method <code>new()</code></h4>

<p>Constructor
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$new(parameters, site_name = "-", run_name = "-")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>parameters</code></dt><dd><p>A ModvegeParameters object.</p>
</dd>
<dt><code>site_name</code></dt><dd><p>string Name of the simulated site.</p>
</dd>
<dt><code>run_name</code></dt><dd><p>string Name of the simulation run. Used to
differentiate between different simulation conditions at the same site.
Defaults to &quot;-&quot;, which indicates no specific run name.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-initialize_state_variables"></a>



<h4>Method <code>initialize_state_variables()</code></h4>

<p>Initialize all relevant state variables
</p>
<p>Firstly, an empty vector of length <em>days_per_year</em> is created for each
variable name in the vector <code>self$state_variable_names</code>.
Then, some additional variables relating to management and water balance
are also initialized.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$initialize_state_variables()</pre></div>


<hr>
<a id="method-ModvegeSite-get_weather"></a>



<h4>Method <code>get_weather()</code></h4>

<p>Return weather data if it exists
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$get_weather()</pre></div>


<hr>
<a id="method-ModvegeSite-get_management"></a>



<h4>Method <code>get_management()</code></h4>

<p>Return management data if it exists
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$get_management()</pre></div>


<hr>
<a id="method-ModvegeSite-get_start_of_growing_season"></a>



<h4>Method <code>get_start_of_growing_season()</code></h4>

<p>Get index (or, equivalently, DOY) of the start of the growing season.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$get_start_of_growing_season(
  critical_temperature = 5,
  consider_snow = FALSE,
  critical_snow = 1
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>critical_temperature</code></dt><dd><p>Daily average temperature in degree
Celsius required for a day being considered &quot;warm enough&quot; for growth.</p>
</dd>
<dt><code>consider_snow</code></dt><dd><p>Toggle whether the effect of snow cover is to be
considered.</p>
</dd>
<dt><code>critical_snow</code></dt><dd><p>Minimum daily snowfall in mm for a day to be
considered snowy.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-carry_over_from_last_day"></a>



<h4>Method <code>carry_over_from_last_day()</code></h4>

<p>Set calculation values to the values stored in
previously used position.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$carry_over_from_last_day()</pre></div>


<hr>
<a id="method-ModvegeSite-calculate_growth"></a>



<h4>Method <code>calculate_growth()</code></h4>

<p>Update all variables which change on a daily basis and
calculate biomass production.
</p>
<p>This function updates the following attributes:
LAIGV
AET
WR
ENVfPAR
ENVfT
ENVfW
ENV
PGRO
GRO
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$calculate_growth()</pre></div>


<hr>
<a id="method-ModvegeSite-calculate_ageing"></a>



<h4>Method <code>calculate_ageing()</code></h4>

<p>Calculate the ageing, senescence and abscission of different biomass
compartments.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$calculate_ageing()</pre></div>


<hr>
<a id="method-ModvegeSite-update_biomass"></a>



<h4>Method <code>update_biomass()</code></h4>

<p>Calculate and update the amount of biomass in each
compartment.
</p>
<p>:TODO: These derived values can be calculated vectorially upon request.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$update_biomass()</pre></div>


<hr>
<a id="method-ModvegeSite-calculate_digestibility"></a>



<h4>Method <code>calculate_digestibility()</code></h4>

<p>Caclulate the organic matter digestibility of each compartment.
</p>
<p>:TODO: These derived values can be calculated vectorially upon
request and thus do not need to be part of a for loop.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$calculate_digestibility()</pre></div>


<hr>
<a id="method-ModvegeSite-apply_cuts"></a>



<h4>Method <code>apply_cuts()</code></h4>

<p>Simulate the effects of cuts on the grass growth.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$apply_cuts()</pre></div>


<hr>
<a id="method-ModvegeSite-determine_cut_from_input"></a>



<h4>Method <code>determine_cut_from_input()</code></h4>

<p>Read from the input whether a cut occurs on day <em>j</em>.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$determine_cut_from_input(DOY)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>DOY</code></dt><dd><p>Integer day of the year for which to check.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-determine_cut_automatically"></a>



<h4>Method <code>determine_cut_automatically()</code></h4>

<p>Decide based on simple criteria whether day of year <em>DOY</em> would be a
good day to cut.
</p>
<p>This follows an implementation described in
Petersen, Krischan, David Kraus, Pierluigi Calanca, Mikhail A.
Semenov, Klaus Butterbach-Bahl, and Ralf Kiese. “Dynamic Simulation
of Management Events for Assessing Impacts of Climate Change on
Pre-Alpine Grassland Productivity.” European Journal of Agronomy
128 (August 1, 2021): 126306.
https://doi.org/10.1016/j.eja.2021.126306.
</p>
<p>The decision to cut is made based on two criteria.
First, it is checked whether a <em>target biomass</em> is reached on given
DOY. The defined target depends on the DOY and is given through
:func:<code>get_target_biomass</code>. If said biomass is present, return <code>TRUE</code>.
</p>
<p>Otherwise, it is checked whether a given amount of time has passed
since the last cut. Depending on whether this is the first cut of
the season or not, the relevant parameters are
:int:<code>last_DOY_for_initial_cut</code> and :int:<code>max_cut_period</code>.
If that amount of time has passed, return <code>TRUE</code>, otherwise return
<code>FALSE</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$determine_cut_automatically(DOY)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>DOY</code></dt><dd><p>Integer day of the year for which to make a cut decision.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-check_dry_days"></a>



<h4>Method <code>check_dry_days()</code></h4>

<p>Return TRUE if there are only <em>dry</em> days in the next <em>n</em>
days from given <em>DOY</em>.
</p>
<p>:TODO:
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$check_dry_days()</pre></div>


<hr>
<a id="method-ModvegeSite-get_target_biomass"></a>



<h4>Method <code>get_target_biomass()</code></h4>

<p>Get target value of biomass on given <em>DOY</em>, which determines whether
a cut is to occur.
</p>
<p>The regression for the target biomass is based on Fig. S2 in the
supplementary material of
Petersen, Krischan, David Kraus, Pierluigi Calanca, Mikhail A.
Semenov, Klaus Butterbach-Bahl, and Ralf Kiese. “Dynamic Simulation
of Management Events for Assessing Impacts of Climate Change on
Pre-Alpine Grassland Productivity.” European Journal of Agronomy
128 (August 1, 2021): 126306.
https://doi.org/10.1016/j.eja.2021.126306.
</p>
<p>A refinement to expected yield as function of altitude has been
implemented according to Table 1a in
Huguenen-Elie et al. &quot;Düngung von Grasland&quot;, Agrarforschung Schweiz,
8, (6), 2017,
https://www.agrarforschungschweiz.ch/2017/06/9-duengung-von-grasland-grud-2017/
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$get_target_biomass(DOY, intensity = "high")</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>DOY</code></dt><dd><p>Integer day of the year to consider.</p>
</dd>
<dt><code>intensity</code></dt><dd><p>One of &quot;high&quot;, &quot;middle&quot;, &quot;low&quot; specifying
management intensity..</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-run"></a>



<h4>Method <code>run()</code></h4>

<p>Carry out a ModVege simulation for one year.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$run(year, weather, management)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>year</code></dt><dd><p>Integer specifying the year to consider. (Unused?)</p>
</dd>
<dt><code>weather</code></dt><dd><p>Weather List for given year as returned by
:method:<code>Weather$get_weather_for_year</code></p>
</dd>
<dt><code>management</code></dt><dd><p>Management List for given year as provided by
:class:<code>ModvegeEnvironment</code>'s :method:<code>get_environment_for_year</code>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-make_header"></a>



<h4>Method <code>make_header()</code></h4>

<p>Construct a string full of meta information on a ModVege
run that can be inserted as a header to an output file.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$make_header()</pre></div>


<hr>
<a id="method-ModvegeSite-write_output"></a>



<h4>Method <code>write_output()</code></h4>

<p>Write values of ModVege results into given file.
</p>
<p>A header with metadata is prepended to the actual data.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$write_output(filename)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filename</code></dt><dd><p>Path or name of filename to be created or overwritten.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-set_parameters"></a>



<h4>Method <code>set_parameters()</code></h4>

<p>Savely update the values in <code>self$parameters</code>.
</p>
<p>Special care is taken to account for potential changes to
functional group weights.
</p>
<p>:TODO: This could be implemented using just a list as input.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$set_parameters(param_names, param_values)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>param_names</code></dt><dd><p>Vector containing the names of the parameters to be
updated.</p>
</dd>
<dt><code>param_values</code></dt><dd><p>Vector containing the corresponding values to the
parameters in <em>param_names</em>.</p>
</dd>
</dl>

</div>


<hr>
<a id="method-ModvegeSite-clone"></a>



<h4>Method <code>clone()</code></h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>ModvegeSite$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p>
</dd>
</dl>

</div>




<h3>Note</h3>

<p>Technically, not all of the variables listed in
<code>state_variable_names</code> are re-initialized, as some of them already hold
the right values for the simulation. Particularly, this is the case for:
OMDDV, OMDDR
</p>


<h3>References</h3>


\insertRef<p>jouven2006ModelPredictingDynamicsrmodvege

</p>


<h3>See Also</h3>

<p>:func:<code>get_target_biomass</code>
</p>


</div>
</body></html>
